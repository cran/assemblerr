<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Sebastian Ueckert" />

<meta name="date" content="2021-07-27" />

<title>Getting started</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Getting started</h1>
<h4 class="author">Sebastian Ueckert</h4>
<h4 class="date">2021-07-27</h4>



<p>assemblerr is an R package helping you build pharmacometric models quickly and without hassle. The package allows you to assemble a model from a set of predefined building blocks and then convert it to NONMEM code. This document will show you the most important steps when working with assemblerr and is an excellent place to start if you are new to the package. We will use a few examples to discuss how to :</p>
<ul>
<li><a href="#assemble-a-simple-model">Assemble a simple model</a></li>
<li><a href="#check-and-modify">Check and modify</a> the model</li>
<li>Turn the assembled model into NONMEM code using <a href="#rendering">rendering</a></li>
<li>Specify what <a href="#tasks">tasks</a> the model code should implement</li>
<li>Write more complex models using [differential equations]</li>
<li>Create <a href="#pharmacokinetic-models">pharmacokinetic models</a> even faster</li>
<li>And get <a href="#more-help">more help</a></li>
</ul>
<div id="assemble-a-simple-model" class="section level2">
<h2>Assemble a simple model</h2>
<p>Let’s start simple and assume you want to build a dose-response model using an Emax function. The following code would accomplish that:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">m &lt;-<span class="st"> </span><span class="kw">model</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="st">  </span><span class="kw">prm_log_normal</span>(<span class="st">&quot;emax&quot;</span>, <span class="dt">median =</span> <span class="dv">10</span>, <span class="dt">var_log =</span> <span class="fl">0.09</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="st">  </span><span class="kw">prm_log_normal</span>(<span class="st">&quot;ed50&quot;</span>, <span class="dt">median =</span> <span class="dv">50</span>, <span class="dt">var_log =</span> <span class="fl">0.09</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="st">  </span><span class="kw">algebraic</span>(effect<span class="op">~</span>emax<span class="op">*</span>dose<span class="op">/</span>(ed50 <span class="op">+</span><span class="st"> </span>dose)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="st">  </span><span class="kw">obs_additive</span>(<span class="op">~</span>effect, <span class="dt">var_add =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>The first line is the so-called constructor, something like the foundation of what you are trying to build. In this example, we are building a general pharmacometric model. Later, we will discuss when and why you would choose something else. All other lines specify building blocks and combine them using the <code>+</code> operator. What each of the building blocks defines is hopefully clear from its name, but let’s go through them anyway to be sure:</p>
<ul>
<li>Line 2 and 3 define the parameters “emax” and “ed50” as being log-normally distributed with a specific median and variance on the log-scale.</li>
<li>Line 4 defines the algebraic relationship for the variable effect using a classical <code>R</code> formula. In these formulae, the <code>~</code> should be understood like a <code>=</code>. You can use formulae in assemblerr whenever you want to define a mathematical relationship.<br />
</li>
<li>Line 5 defines the observational model, i.e., what is the observation in the model (the variable “effect” in this case) as well as the model for residual error (additive) and the variance of the error term.</li>
</ul>
<p>Let’s assume you want to create a model with a proportional error model instead and change the initial estimate for it, you would simply need to exchange the last line to something like <code>obs_proportional(~effect, var_prop = 0.05)</code>. Similarly, if you would want to switch one of the parameters shown above, you could also change it. The use of these exchangeable building blocks is the core principle in assemblerr.</p>
</div>
<div id="check-and-modify" class="section level2">
<h2>Check and modify</h2>
<p>When you are done defining your model you can check whether it contains any issues using the <code>check()</code> function, e.g.,</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">check</span>(m)</a></code></pre></div>
<pre><code>## ! 1 critical issue</code></pre>
<pre><code>##   1. Undefined variable &#39;dose&#39; in algebraics</code></pre>
<p>In this case, the model definition used the variable ‘dose’ without it being declared. You can tell assemblerr that dose is part of the dataset by modifying the model as follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">m &lt;-<span class="st"> </span>m <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="st">  </span><span class="kw">input_variable</span>(<span class="st">&quot;dose&quot;</span>)</a></code></pre></div>
<p>Now, the check function does not find any issues:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">check</span>(m)</a></code></pre></div>
<pre><code>## ✓ No issues</code></pre>
<p>You can also replace an already existing building block by adding a new one with the same name. For example, the following code updates the parameter model for the Emax parameter to one without variability:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">m &lt;-<span class="st"> </span>m <span class="op">+</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="st">  </span><span class="kw">prm_no_var</span>(<span class="st">&quot;emax&quot;</span>, <span class="dt">value =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## Warning: Building block replaced
## x The building block [emax: log-normal] has been replaced with [emax: no variability]</code></pre>
<p>The warning message indicates that an existing building block has been replace. Now, there won’t be any random effect associated with Emax when you render the modified model:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">render</span>(m)</a></code></pre></div>
<pre><code>## $PROBLEM
## $INPUT DOSE ID DV
## $DATA data.csv IGNORE=@
## $PRED
## EMAX = THETA(1)
## ED50 = THETA(2) * EXP(ETA(1))
## EFFECT = EMAX * DOSE/(ED50 + DOSE)
## Y = EFFECT + EPS(1)
## $ESTIMATION METHOD=COND MAXEVAL=999999 
## $THETA (0, 10, Inf) ; POP_EMAX
## $THETA (0, 50, Inf) ; POP_ED50
## $OMEGA 0.09 ; IIV_ED50
## $SIGMA 1; RUV_ADD</code></pre>
</div>
<div id="rendering" class="section level2">
<h2>Rendering</h2>
<p>After having defined your model, you probably want to turn it into something useful, in assemblerr this process is called rendering. Since we stored our assembled model above in the variable <code>m</code> we can simply pass this variable to the <code>render</code> function, which will write the resulting NONMEM code to the console, like so</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">render</span>(m)</a></code></pre></div>
<pre><code>## $PROBLEM
## $INPUT DOSE ID DV
## $DATA data.csv IGNORE=@
## $PRED
## EMAX = THETA(1)
## ED50 = THETA(2) * EXP(ETA(1))
## EFFECT = EMAX * DOSE/(ED50 + DOSE)
## Y = EFFECT + EPS(1)
## $ESTIMATION METHOD=COND MAXEVAL=999999 
## $THETA (0, 10, Inf) ; POP_EMAX
## $THETA (0, 50, Inf) ; POP_ED50
## $OMEGA 0.09 ; IIV_ED50
## $SIGMA 1; RUV_ADD</code></pre>
<p>While this is great to quickly check the resulting code, we generally want a model file. We can create it using the <code>filename=</code> argument of the <code>render()</code> function, i.e.,</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">setwd</span>(<span class="kw">tempdir</span>())</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">render</span>(m, <span class="dt">filename =</span> <span class="st">&quot;run1.mod&quot;</span>)</a></code></pre></div>
<p>The <code>render</code> function also has an options argument that allows you to modify some aspects of the rendering process. For example, the following code automatically adds the mu-referenced code for all parameters.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">render</span>(</a>
<a class="sourceLine" id="cb15-2" title="2">  m, </a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="dt">options =</span> <span class="kw">assemblerr_options</span>(</a>
<a class="sourceLine" id="cb15-4" title="4">    <span class="dt">prm.use_mu_referencing =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb15-5" title="5">  )</a>
<a class="sourceLine" id="cb15-6" title="6">)</a></code></pre></div>
<pre><code>## $PROBLEM
## $INPUT DOSE ID DV
## $DATA data.csv IGNORE=@
## $PRED
## EMAX = THETA(1)
## MU_1 = LOG(THETA(2))
## ED50 = EXP(MU_1 + ETA(1))
## EFFECT = EMAX * DOSE/(ED50 + DOSE)
## Y = EFFECT + EPS(1)
## $ESTIMATION METHOD=COND MAXEVAL=999999 
## $THETA (0, 10, Inf) ; POP_EMAX
## $THETA (0, 50, Inf) ; POP_ED50
## $OMEGA 0.09 ; IIV_ED50
## $SIGMA 1; RUV_ADD</code></pre>
</div>
<div id="tasks" class="section level2">
<h2>Tasks</h2>
<p>“All models are wrong” AND useless if we cannot do anything with them. So far, you only saw the description of a model. The <code>tasks=</code> argument of the <code>render()</code> function allows you to specify what the model should “do”.</p>
<p>By default assemblerr adds an estimation task using the FOCE algorithm but you can change that, for example using:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">render</span>(m, </a>
<a class="sourceLine" id="cb17-2" title="2">       <span class="dt">tasks =</span> <span class="kw">tsk_estimation</span>(<span class="dt">algorithm =</span> <span class="st">&quot;imp&quot;</span>, <span class="dt">se =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## $PROBLEM
## $INPUT DOSE ID DV
## $DATA data.csv IGNORE=@
## $PRED
## EMAX = THETA(1)
## ED50 = THETA(2) * EXP(ETA(1))
## EFFECT = EMAX * DOSE/(ED50 + DOSE)
## Y = EFFECT + EPS(1)
## $ESTIMATION METHOD=IMP AUTO=1 
## $COVARIANCE PRINT=E
## $THETA (0, 10, Inf) ; POP_EMAX
## $THETA (0, 50, Inf) ; POP_ED50
## $OMEGA 0.09 ; IIV_ED50
## $SIGMA 1; RUV_ADD</code></pre>
<p>This example also requested the standard errors for the estimated parameters, which resulted in the addition of the covariance step in the NONMEM code.</p>
<p>You can combine multiple tasks using the <code>+</code> operator. For example, you might want to estimate parameters and output the parameter values for all parameters in the model. The following code accomplishes this:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">render</span>(m, </a>
<a class="sourceLine" id="cb19-2" title="2">       <span class="dt">tasks =</span> <span class="kw">tsk_estimation</span>() <span class="op">+</span><span class="st"> </span><span class="kw">tsk_output</span>(<span class="dt">filename =</span> <span class="st">&quot;sdtab&quot;</span>, <span class="dt">variables =</span> <span class="kw">vars_prms</span>()))</a></code></pre></div>
<pre><code>## $PROBLEM
## $INPUT DOSE ID DV
## $DATA data.csv IGNORE=@
## $PRED
## EMAX = THETA(1)
## ED50 = THETA(2) * EXP(ETA(1))
## EFFECT = EMAX * DOSE/(ED50 + DOSE)
## Y = EFFECT + EPS(1)
## $ESTIMATION METHOD=COND MAXEVAL=999999 
## $TABLE EMAX ED50 FILE=sdtab NOAPPEND NOPRINT
## $THETA (0, 10, Inf) ; POP_EMAX
## $THETA (0, 50, Inf) ; POP_ED50
## $OMEGA 0.09 ; IIV_ED50
## $SIGMA 1; RUV_ADD</code></pre>
<p>In the previous example, you saw the variable selection helper <code>vars_prms()</code> in action. Variable selection helpers allow you to specify what variables should be used in a table. You can read more about them in the documentation for the <code>tsk_output()</code> function.</p>
</div>
<div id="ordinary-differential-equations" class="section level2">
<h2>Ordinary differential equations</h2>
<p>Many pharmacometric models are defined using ordinary differential equations. In assemblerr you can specify ordinary differential equations via compartments and flows (while this does not cover all types of ordinary differential equations, it will hopefully get you pretty far). To show compartment and flows in action, we will extend the dose-response model from the beginning to a concentration-response model. The following code chunk shows the necessary changes:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">m2 &lt;-<span class="st"> </span><span class="kw">model</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="st">  </span><span class="kw">prm_log_normal</span>(<span class="st">&quot;v&quot;</span>, <span class="dt">median =</span> <span class="dv">100</span>, <span class="dt">var_log =</span> <span class="fl">0.09</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="st">  </span><span class="kw">prm_log_normal</span>(<span class="st">&quot;cl&quot;</span>, <span class="dt">median =</span> <span class="dv">10</span>, <span class="dt">var_log =</span> <span class="fl">0.09</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="st">  </span><span class="kw">prm_log_normal</span>(<span class="st">&quot;emax&quot;</span>, <span class="dt">median =</span> <span class="dv">10</span>, <span class="dt">var_log =</span> <span class="fl">0.09</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="st">  </span><span class="kw">prm_log_normal</span>(<span class="st">&quot;ec50&quot;</span>, <span class="dt">median =</span> <span class="dv">1</span>, <span class="dt">var_log =</span> <span class="fl">0.09</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-6" title="6"><span class="st">  </span><span class="kw">compartment</span>(<span class="st">&quot;central&quot;</span>, <span class="dt">volume =</span> <span class="st">&quot;v&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-7" title="7"><span class="st">  </span><span class="kw">flow</span>(<span class="dt">from =</span> <span class="st">&quot;central&quot;</span>, <span class="dt">definition =</span> <span class="op">~</span>cl<span class="op">*</span>C) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-8" title="8"><span class="st">  </span><span class="kw">obs_additive</span>(effect<span class="op">~</span>emax<span class="op">*</span>C[<span class="st">&quot;central&quot;</span>]<span class="op">/</span>(ec50 <span class="op">+</span><span class="st"> </span>C[<span class="st">&quot;central&quot;</span>]), <span class="dt">var_add =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>In this model definition, we used two additional parameters and, more importantly, a compartment as well as a flow from that compartment. You should note, how you can use the variable <code>C</code> in the flow definition to refer to the concentration in the “from” compartment. Similarly, you can also use <code>C[&quot;central&quot;]</code> to refer to the concentration in the central compartment when defining the observational model. The <code>A</code> variable provides a reference to the unscaled amount in the compartment.</p>
<p>Pay attention to how assemblerr replaces the <code>C</code> variables with the corresponding compartment reference when we render the model like before:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">render</span>(m2)</a></code></pre></div>
<pre><code>## $PROBLEM
## $INPUT ID TIME DV AMT
## $DATA data.csv IGNORE=@
## $SUBROUTINES ADVAN1  TRANS2 
## $PK
## V = THETA(1) * EXP(ETA(1))
## CL = THETA(2) * EXP(ETA(2))
## EMAX = THETA(3) * EXP(ETA(3))
## EC50 = THETA(4) * EXP(ETA(4))
## $ERROR
## EFFECT = EMAX * (A(1)/V)/(EC50 + A(1)/V)
## Y = EFFECT + EPS(1)
## $ESTIMATION METHOD=COND MAXEVAL=999999 
## $THETA (0, 100, Inf) ; POP_V
## $THETA (0, 10, Inf) ; POP_CL
## $THETA (0, 10, Inf) ; POP_EMAX
## $THETA (0, 1, Inf) ; POP_EC50
## $OMEGA 0.09 ; IIV_V
## $OMEGA 0.09 ; IIV_CL
## $OMEGA 0.09 ; IIV_EMAX
## $OMEGA 0.09 ; IIV_EC50
## $SIGMA 1; RUV_ADD</code></pre>
<p>Did you also notice what happened to the differential equation? It disappeared! assemblerr recognized that this simple one-compartment model could be written as a much quicker analytical solution using ADVAN1 and did the necessary replacements.</p>
</div>
<div id="pharmacokinetic-models" class="section level2">
<h2>Pharmacokinetic models</h2>
<p>For PK models, assemblerr supports building blocks with a higher level of abstraction. The following snippet assembles a one-compartment model with linear elimination:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">pkm &lt;-<span class="st"> </span><span class="kw">pk_model</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb24-2" title="2"><span class="st">  </span><span class="kw">pk_absorption_fo</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="st">  </span><span class="kw">pk_distribution_1cmp</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb24-4" title="4"><span class="st">  </span><span class="kw">pk_elimination_linear</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb24-5" title="5"><span class="st">  </span><span class="kw">obs_additive</span>(conc<span class="op">~</span>C[<span class="st">&quot;central&quot;</span>]) </a></code></pre></div>
<p>You can see how <code>pk_model()</code> instead of <code>model()</code> was used as a constructor. The resulting model objects accepts building blocks such as:</p>
<ul>
<li>A first-order absorption model (line 2)</li>
<li>A compartment distribution model (line 3)</li>
<li>A linear elimination model (line 4)</li>
</ul>
<p>as well as the additive observation model (line 5) that you saw before.</p>
<p>Despite its slightly different nature, you can turn the model into NONMEM code using the <code>render()</code> function. Also, tasks and rendering options work like in the previous examples. You could therefore do the following to create NONMEM code with mu-referencing, importance sampling estimation, and a table containing all model parameters:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">render</span>(</a>
<a class="sourceLine" id="cb25-2" title="2">  <span class="dt">model =</span> pkm, </a>
<a class="sourceLine" id="cb25-3" title="3">  <span class="dt">tasks =</span> <span class="kw">tsk_estimation</span>(<span class="st">&quot;imp&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">tsk_output</span>(<span class="st">&quot;sdtab&quot;</span>, <span class="dt">variables =</span> <span class="kw">vars_prms</span>()),</a>
<a class="sourceLine" id="cb25-4" title="4">  <span class="dt">options =</span> <span class="kw">assemblerr_options</span>(<span class="dt">prm.use_mu_referencing =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb25-5" title="5">)</a></code></pre></div>
<pre><code>## $PROBLEM
## $INPUT ID TIME DV AMT
## $DATA data.csv IGNORE=@
## $SUBROUTINES ADVAN2  TRANS2 
## $PK
## MU_1 = LOG(THETA(1))
## MAT = EXP(MU_1 + ETA(1))
## MU_2 = LOG(THETA(2))
## VC = EXP(MU_2 + ETA(2))
## MU_3 = LOG(THETA(3))
## CL = EXP(MU_3 + ETA(3))
## KA = 1/MAT
## V = VC
## $ERROR
## CONC = A(2)/VC
## Y = CONC + EPS(1)
## $ESTIMATION METHOD=IMP AUTO=1 
## $TABLE MAT VC CL FILE=sdtab NOAPPEND NOPRINT
## $THETA (0, 0.5, Inf) ; POP_MAT
## $THETA (0, 100, Inf) ; POP_VC
## $THETA (0, 50, Inf) ; POP_CL
## $OMEGA 0.1 ; IIV_MAT
## $OMEGA 0.1 ; IIV_VC
## $OMEGA 0.1 ; IIV_CL
## $SIGMA 1; RUV_ADD</code></pre>
<p>PK model building blocks come with a default parameter model for their parameters. You can change the default by providing the parameter model as an argument to the building blocks. For example, if you want to have no variability on the volume of distribution, you could use the following code (note also how VC was renamed to V1):</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">pkm &lt;-<span class="st"> </span><span class="kw">pk_model</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="st">  </span><span class="kw">pk_absorption_fo</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb27-3" title="3"><span class="st">  </span><span class="kw">pk_distribution_1cmp</span>(<span class="dt">prm_vc =</span> <span class="kw">prm_no_var</span>(<span class="st">&quot;v1&quot;</span>, <span class="dt">value =</span> <span class="dv">100</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-4" title="4"><span class="st">  </span><span class="kw">pk_elimination_linear</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb27-5" title="5"><span class="st">  </span><span class="kw">obs_additive</span>(conc<span class="op">~</span>C[<span class="st">&quot;central&quot;</span>]) </a>
<a class="sourceLine" id="cb27-6" title="6"></a>
<a class="sourceLine" id="cb27-7" title="7"><span class="kw">render</span>(pkm)</a></code></pre></div>
<pre><code>## $PROBLEM
## $INPUT ID TIME DV AMT
## $DATA data.csv IGNORE=@
## $SUBROUTINES ADVAN2  TRANS2 
## $PK
## MAT = THETA(1) * EXP(ETA(1))
## V1 = THETA(2)
## CL = THETA(3) * EXP(ETA(2))
## KA = 1/MAT
## V = V1
## $ERROR
## CONC = A(2)/V1
## Y = CONC + EPS(1)
## $ESTIMATION METHOD=COND MAXEVAL=999999 
## $THETA (0, 0.5, Inf) ; POP_MAT
## $THETA (0, 100, Inf) ; POP_V1
## $THETA (0, 50, Inf) ; POP_CL
## $OMEGA 0.1 ; IIV_MAT
## $OMEGA 0.1 ; IIV_CL
## $SIGMA 1; RUV_ADD</code></pre>
<p>Alternatively, you can overwrite the default parameter model by adding a another one with the same name, i.e., :</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">pkm &lt;-<span class="st"> </span><span class="kw">pk_model</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="st">  </span><span class="kw">pk_absorption_fo</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="st">  </span><span class="kw">pk_distribution_1cmp</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb29-4" title="4"><span class="st">  </span><span class="kw">pk_elimination_linear</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb29-5" title="5"><span class="st">  </span><span class="kw">prm_no_var</span>(<span class="st">&quot;vc&quot;</span>, <span class="dt">value =</span> <span class="dv">100</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-6" title="6"><span class="st">  </span><span class="kw">obs_additive</span>(conc<span class="op">~</span>C[<span class="st">&quot;central&quot;</span>]) </a></code></pre></div>
<pre><code>## Warning: Building block replaced
## x The building block [vc: log-normal] has been replaced with [vc: no variability]</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">render</span>(pkm)</a></code></pre></div>
<pre><code>## $PROBLEM
## $INPUT ID TIME DV AMT
## $DATA data.csv IGNORE=@
## $SUBROUTINES ADVAN2  TRANS2 
## $PK
## MAT = THETA(1) * EXP(ETA(1))
## VC = THETA(2)
## CL = THETA(3) * EXP(ETA(2))
## KA = 1/MAT
## V = VC
## $ERROR
## CONC = A(2)/VC
## Y = CONC + EPS(1)
## $ESTIMATION METHOD=COND MAXEVAL=999999 
## $THETA (0, 0.5, Inf) ; POP_MAT
## $THETA (0, 100, Inf) ; POP_VC
## $THETA (0, 50, Inf) ; POP_CL
## $OMEGA 0.1 ; IIV_MAT
## $OMEGA 0.1 ; IIV_CL
## $SIGMA 1; RUV_ADD</code></pre>
</div>
<div id="more-help" class="section level2">
<h2>More help</h2>
<p>There is more to learn about assemblerr and you have multiple sources available:</p>
<ul>
<li>Help for a specific function can be found in the reference documentation in R. It can be accessed using <code>?</code>. For example, <code>?prm_log_normal</code> will open the documentation for the log-normal parameter building block. You can find links to similar building blocks at the bottom of each help page.</li>
<li>An overview of the available documentation is available via <code>help(package=&quot;assemblerr&quot;)</code>.</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
